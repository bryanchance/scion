## SIG configuration File

The SIG Config File is a JSON file that contains the following information:

* **ConfigVersion**. The config version, which is the UNIX timestamp of the date
  when the config was generated by the *SIG Policy Configurator*. This field
  can be absent.
* **ASes**. A dictionary of known remote Autonomous Systems.
* **Classes**. A dictionary of traffic classifiers.
* **Actions**. A dictionary of path filters.

```json
{
  "ConfigVersion": 1517926867,
  "ASes": {
    ...
  },
  "Classes": {
    ...
  },
  "Actions": {
    ...
  }
}
```

### ASes

The top-level ASes field contains a JSON object of SCION ISD-AS identifiers mapping to objects containing:

* **Nets**. The IPv4 prefixes contained in the remote AS
* **Sigs**. A JSON dictionary of addresses for remote SIGs. Multiple SIGs can be defined.
* **Sessions**. A JSON dictionary of SIG to SIG traffic sessions. The
  classification engine uses custom rules to add IPv4 packets to various
  classes. Classes are then mapped to Sessions via PktPolicies.
* **PktPolicies**. A List of associations between Classes and Sessions. Classes
  are referenced via field Classname, and SessionIDs via a JSON array of
  Sessions. A Packet Policy states that traffic of the specified class should
  attempt to use the first session in the array, if healthy (i.e., at least one
  path is available for that session and traffic flows correctly). If a session
  is unhealthy, the policy will try to use the next one, and so on and so forth.

### Defining custom classes

This field is usually edited by interacting with the SIG Policy Configurator
tool. The tool offers a simplified interface where traffic rules are entered
one per line, and the tool then compiles the JSON file and pushes it to the
target SIG.

#### Hierarchical operators
Classes support two hierachical operators:

  * **CondAllOf**: Logical AND operator. If empty, evaluates to true. If not
    empty, evaluates to true only if all child conditions evaluate to true.
  * **CondAnyOf**: Logical OR operator. If empty, evaluates to true. If not
    empty, evaluates to true if at least one child condition evaluates to true.


#### Non-hierarchical operators
Classes also support three non-hierarchical operators:

  * **CondIPv4**: A condition that operates on IPv4 header fields. Currently
    the following predicates are supported:
    * **MatchSource**: Evaluates to true if the packet's source address is
      inside the network specified by the "Net" field.
    * **MatchDestination**: Evaluates to true if the packet's destination
      address is inside the network specified by the "Net" field.
    * **MatchDSCP**: Evaluates to true if the packet's ToS field exactly
      matches the value in the "DSCP" field.
  * **CondTrue**: Always evaluates to true.
  * **CondFalse**: Always evaluates to false.

#### Defining path selection actions

Field **Actions** can be used to filter SCION paths. Currently one type of
filtering is supported, **Contains**, which checks whether a given path
contains an ISD-AS#IFID hop. Once defined, Actions can be referenced in
Sessions to specify which paths are eligible for selection in that session.

### Full config file example
```
  {
    "ConfigVersion": 1517926867,
    "ASes": {
      "100-2": {
        "Nets": ["169.254.1.0/24", "198.19.254.0/24", "10.9.0.0/24"],
        "Sigs": {
          "sigB": {
            "Addr": "169.254.1.1"
          }
        },
        "Sessions": {
          "0": "",
          "12": "pathA",
          "44": "pathB",
          "23": "pathC"
        },
        "PktPolicies": [
          {
            "Classname": "hello",
            "SessIDs": [
              1,
              2,
              3
            ]
          }
        ]
      }
    },
    "Classes": {
      "hello": {
        "CondAllOf": [
          {
            "CondIPv4": {
              "MatchSource": {
                "Net": "192.168.1.0/24"
              }
            }
          },
          {
            "CondIPv4": {
              "MatchDestination": {
                "Net": "192.168.2.0/24"
              }
            }
          },
          {
            "CondIPv4": {
              "MatchDSCP": {
                "DSCP": "0x12"
              }
            }
          }
        ]
      }
    },
    "Actions": {
      "pathA": {
        "ActionFilterPaths": {
          "Contains": "100-1#29"
        }
      },
      "pathB": {
        "ActionFilterPaths": {
          "Contains": "100-1#19"
        }
      },
      "pathC": {
        "ActionFilterPaths": {
          "Contains": "100-1#39"
        }
      }
    }
  }
```
